@page "/"
@using Microsoft.JSInterop.Implementation
@using Game
@inject IJSRuntime Js

@code{
    static Game _game;
    protected override void OnInitialized()
    {
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Js.InvokeVoidAsync("init");
            var scene = new Scene(Js, Settings.CenterWidth, Settings.CenterHeight, 1f);
            await scene.Init();
            foreach (var name in Enum.GetValues(typeof(AssetList)))
            {
                if ((AssetList) name == AssetList.None)
                    continue;
                var actor = await scene.CreateActor();
                var obj = typeof(Assets).GetField(name.ToString() ?? string.Empty);
                var asset = (float[]) obj?.GetValue(null)!;
                actor.UploadData(asset);
                AssetManager.AddActor((AssetList) name, actor);
            }
            _game = new Game(scene);
            _game.SnakeMove(-1);
            await Js.InvokeVoidAsync("loop");

        }
    }

    [JSInvokable]
    public static void Run(float val)
    {
        _game.SnakeMove(0);
        _game.Update(val);
        _game.Draw();
    }

}

<PageTitle>Index</PageTitle>
<h1>Hello, world!</h1>
<canvas width="800" height="600"></canvas>